$(document).ready(function(){let hasSearched=!1;setInterval(function(){""!==$("#search-term").val()||$("#search-btn").hasClass("disabled")||$("#search-btn").addClass("disabled")},1),$(".collapsible").collapsible(),$(".modal").modal();var config={apiKey:"AIzaSyCCuhVM3rHwb0Qq8qrPlFWdCaQCEg0QYm0",authDomain:"band-aggregator.firebaseapp.com",databaseURL:"https://band-aggregator.firebaseio.com",projectId:"band-aggregator",storageBucket:"band-aggregator.appspot.com",messagingSenderId:"432642484449"};firebase.initializeApp(config);let bandDB=firebase.database();bandDB.ref("searches/").orderByChild("searchCount").limitToLast(5).on("value",snapshot=>{const $statsTableBody=$(".statsTableBody");$statsTableBody.empty(),snapshot.forEach(childSnapshot=>{const $statsTableRow=$("<tr>"),$statsTableName=$("<td>"),$statsTableSearches=$("<td>");$(".statsTableBody").css({"font-weight":"bold","font-size":"20px","font-family":"Noto Serif"});let childRecord=childSnapshot.val();$statsTableName.text(childRecord.artist),$statsTableSearches.text(childRecord.searchCount),$statsTableRow.append($statsTableName,$statsTableSearches),$statsTableBody.prepend($statsTableRow)})}),bandDB.ref("Artists").on("value",snapshot=>{let mostRecent=snapshot.val().name,$recentSearchesPar;JSON.stringify(mostRecent),$(".statsRecentSearches").text("Most recent search: "+mostRecent),$(".statsRecentSearches").css({"font-weight":"bolder","text-align":"center","margin-top":"10px","font-size":"20px"})});const toTitleCase=str=>str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()});function updateSearchStats(){let searchTerm=$("#search-term").val().toLowerCase().trim();var searchCount=0;bandDB.ref("searches/"+searchTerm).on("value",snapshot=>{searchCount=snapshot.val()&&snapshot.val().searchCount||0}),searchCount+=1;let titleSearchTerm=toTitleCase(searchTerm);bandDB.ref("searches/"+searchTerm).set({searchCount:searchCount,artist:titleSearchTerm},error=>{})}const wikiParseURL=str=>(str=(str=toTitleCase(str)).replace(/[" "]/gim,"%20")).trim(),animateIn=()=>{$(".title").addClass("min"),$(".band-image").removeClass("hide fadeOutLeftBig").addClass("fadeInLeftBig"),$(".band-name").removeClass("hide fadeOutRightBig").addClass("fadeInRightBig"),$(".bg0, .bg2, .bg4").removeClass("hide fadeOutLeftBig").addClass("fadeInLeftBig"),$(".bg1, .bg3").removeClass("hide fadeOutRightBig").addClass("fadeInRightBig"),fitty(".band-name",{maxSize:325}),fitty(".bg0"),fitty(".bg1"),fitty(".bg2"),fitty(".bg3"),fitty(".bg4"),setTimeout(function(){$(".bio").addClass("fadeInRightBig").removeClass("hide fadeOutRightBig"),setTimeout(function(){$(".collapsible").addClass("fadeInUpBig").removeClass("hide fadeOutDownBig"),setTimeout(function(){$(".footer-copyright").addClass("fadeInUpBig").removeClass("hide")},250)},250)},250)},animateOut=()=>{$(".band-image").removeClass("fadeInLeftBig").addClass("fadeOutLeftBig"),$(".band-name").removeClass("fadeInRightBig").addClass("fadeOutRightBig"),$(".bg0, .bg2, .bg4").removeClass("fadeInLeftBig").addClass("fadeOutLeftBig"),$(".bg1, .bg3").removeClass("fadeInRightBig").addClass("fadeOutRightBig"),fitty(".band-name",{maxSize:325}),fitty(".bg0"),fitty(".bg1"),fitty(".bg2"),fitty(".bg3"),fitty(".bg4"),setTimeout(function(){$(".bio").removeClass("fadeInRightBig").addClass("fadeOutRightBig"),setTimeout(function(){$(".collapsible").removeClass("fadeInUpBig").addClass("fadeOutDownBig")},250)},250)},mediaWikiimageAJAX=pageID=>{let wikiQueryURL=`https://cors-anywhere.herokuapp.com/en.wikipedia.org/w/api.php?action=query&prop=pageimages&format=json&piprop=original&pageids=${pageID}`;$.ajax({url:wikiQueryURL,method:"GET",datatype:"json"}).then(function(wikiResponse){void 0!==Object.values(wikiResponse.query.pages)[0].original?$(".artist-image").attr("src",Object.values(wikiResponse.query.pages)[0].original.source):""===$(".album0Img").attr("src")?$(".artist-image").attr("src","https://www.mikrodots.com/wp-content/uploads/2016/07/placeholder.jpg"):$(".artist-image").attr("src",$(".album0Img").attr("src"))})},mediaWikiSummaryAJAX=page=>{if(void 0===page){let artistInput=$("#search-term").val().trim();$(".bg0, .bg1, .bg2, .bg3, .bg4").text(artistInput);let cleanedInput=wikiParseURL(artistInput),artistQueryURL=`https://cors-anywhere.herokuapp.com/en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exintro=true&titles=${cleanedInput}`;$.ajax({url:artistQueryURL,method:"GET",datatype:"json"}).then(function(wikiResponse){const pageID=Object.values(wikiResponse.query.pages)[0].pageid,extract=Object.values(wikiResponse.query.pages)[0].extract;if(""===extract)cleanedInput="The%20"+cleanedInput,$(".band-name").text(Object.values(wikiResponse.query.pages)[0].title),mediaWikiSummaryAJAX(cleanedInput);else if($(".band-name").text(Object.values(wikiResponse.query.pages)[0].title),mediaWikiimageAJAX(pageID),$extract=$(extract),$(".bio br").remove(),$('.bio p:not(".read-more")').remove(),0!==$extract.length)$(".bio").prepend($extract),$("<br>").insertAfter(".bio p");else{let $explenationPar=$("<p>"),$typoPar=$("<p>"),$rewordPar=$("<p>");$explenationPar.text("We couldn't find an artist bio by that name"),$typoPar.text("Make sure that what you searched is typed correctly"),$rewordPar.text("If that does not help try re-wording the name to fit a wiki search"),$(".bio").prepend($typoPar,$rewordPar)}})}else if(void 0!==page){let wikiQueryURL=`https://cors-anywhere.herokuapp.com/en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exintro=true&titles=${page}`;$.ajax({url:wikiQueryURL,method:"GET",datatype:"json"}).then(function(wikiResponse){const pageID=Object.values(wikiResponse.query.pages)[0].pageid,extract=Object.values(wikiResponse.query.pages)[0].extract;if(void 0!==extract?$(".band-name").text(Object.values(wikiResponse.query.pages)[0].title):setTimeout(function(){""===$(".album0Div").attr("data-artist-name")?$(".band-name").text("We couldn't find an artist by that name"):$(".band-name").text($(".album0Div").attr("data-artist-name"))},250),mediaWikiimageAJAX(pageID),$extract=$(extract),$(".bio br").remove(),$('.bio p:not(".read-more")').remove(),0!==$extract.length)$(".bio").prepend($extract),$("<br>").insertAfter(".bio p");else{let $explenationPar=$("<p>"),$typoPar=$("<p>"),$rewordPar=$("<p>");$explenationPar.text("We couldn't find an artist bio by that name"),$typoPar.text("Make sure that what you searched is typed correctly"),$rewordPar.text("If that does not help try re-wording the name to fit a wiki search"),$(".bio").prepend($explenationPar,$typoPar,$rewordPar)}})}},getArtistAMGID=()=>{let artistInput,IDQueryURL=`https://cors-anywhere.herokuapp.com/itunes.apple.com/search?media=music&limit=1&entity=album&term=${$("#search-term").val().trim()}`;$.ajax({url:IDQueryURL,method:"GET",datatype:"json"}).then(function(artistResponse){let parsedArtistResponse,artistID;itunesAlbumAJAX(JSON.parse(artistResponse).results[0].amgArtistId)})};function itunesAlbumAJAX(artistID){let albumOnIndex=0,albumArray=[];$(".collapsible-body").attr("style",""),$(".album-list").removeClass("active");let artistInput=$("#search-term").val().trim(),albumQueryURL=`https://cors-anywhere.herokuapp.com/itunes.apple.com/lookup?amgArtistId=${artistID}&entity=album`;$.ajax({url:albumQueryURL,method:"GET",datatype:"json"}).then(function(albumResponse){let parsedAlbumResponse,albumResults=JSON.parse(albumResponse).results;albumResults.forEach(function(value,index){"collection"!==value.wrapperType&&albumResults.splice(index,1)}),0!==albumResults&&($.each(albumResults,function(index,value){if(1!==value.trackCount&&-1===$.inArray(value.collectionCensoredName,albumArray)&&albumOnIndex<5){albumArray.push(value.collectionCensoredName);const $newAlbum=$(`\n                        <li class="album-list collection-item">\n                            <div class="collapsible-header album${albumOnIndex}Div valign-wrapper" data-album-name="${value.collectionCensoredName}" data-album-length="${value.trackCount}" data-index="${albumOnIndex}" data-album-id="${value.collectionId}" data-load-state="not-loaded">\n                                <img class="album${albumOnIndex}Img" src="${value.artworkUrl100}">\n                                <p class="album${albumOnIndex}Name album-name truncate">${value.collectionCensoredName}</p>\n                            </div>\n                            <div class="collapsible-body song${albumOnIndex}Div">\n\n                            </div>\n                        </li>`);$(".collapsible").append($newAlbum),$newAlbum.addClass("hvr-grow-shadow").addClass("col s12"),itunesSongAJAX(`album${albumOnIndex}Div`),albumOnIndex++}}),albumOnIndex<5&&$.inArray(albumResults.collectionCensoredName,albumArray)&&$.each(albumResults,function(index,value){if(-1===$.inArray(value.collectionCensoredName,albumArray)&&albumOnIndex<5){albumArray.push(value.collectionCensoredName);const $newAlbum=$(`\n                            <li class="album-list collection-item">\n                                <div class="collapsible-header album${albumOnIndex}Div valign-wrapper" data-album-name="${value.collectionCensoredName}" data-album-length="${value.trackCount}" data-index="${albumOnIndex}" data-album-id="${value.collectionId}" data-load-state="not-loaded">\n                                    <img class="album${albumOnIndex}Img" src="${value.artworkUrl100}">\n                                    <p class="album${albumOnIndex}Name album-name truncate">${value.collectionCensoredName}</p>\n                                </div>\n                                <div class="collapsible-body song${albumOnIndex}Div">\n\n                                </div>\n                            </li>`);$(".collapsible").append($newAlbum),$newAlbum.addClass("hvr-grow-shadow").addClass("col s12"),itunesSongAJAX(`album${albumOnIndex}Div`),albumOnIndex++}})),bandDB.ref("Artists").set({name:artistInput}),$("#search-term").val("")})}function itunesSongAJAX(album){let $thisAlbum=$(`.${album}`);if("not-loaded"===$thisAlbum.attr("data-load-state")){let albumLength=$thisAlbum.attr("data-album-length")-1,forAlbumIndex=$thisAlbum.attr("data-index"),albumID=$thisAlbum.attr("data-album-id");$(".song"+forAlbumIndex+"Div").empty();let songQueryURL=`https://cors-anywhere.herokuapp.com/itunes.apple.com/lookup?id=${albumID}&entity=song&limit=${albumLength}`;$.ajax({url:songQueryURL,method:"GET",datatype:"json"}).then(function(songResponse){let parsedSongResponse,songResults=JSON.parse(songResponse).results;songResults.shift();const $songCollection=$("<ul>");$songCollection.addClass("collection"),$.each(songResults,function(index,value){const $songCollectionItem=$("<li>");$songCollectionItem.addClass("collection-item song"),$songCollectionItem.text(value.trackCensoredName).attr("data-song-name",value.trackCensoredName).attr("data-artist-name",value.artistName),$($songCollection).append($songCollectionItem)}),$(".song"+forAlbumIndex+"Div").append($songCollection),$thisAlbum.attr("data-load-state","loaded")})}}const sanitizeString=str=>(str=str.replace(/[^a-z0-9 \_-]/gim,"")).trim();function lyricsAJAX(){let $thisSong=$(this),songArtistName=sanitizeString($thisSong.attr("data-artist-name")),songName=sanitizeString($thisSong.attr("data-song-name"));const $lyricsModal=$("#lyricsModal"),$lyricsPar=$(".lyricsPar");$(".youtube-content").empty();let lyricsQueryURL=`https://api.lyrics.ovh/v1/${songArtistName}/${songName}`;$.ajax({url:lyricsQueryURL,method:"GET",error:function(){$lyricsPar.text("sorry, we couldn't find lyrics for that song"),$lyricsModal.modal("open"),youtubeVideo(songArtistName,songName)}}).then(function(lyricsResponse){$lyricsPar.text(lyricsResponse.lyrics),$lyricsModal.modal("open"),youtubeVideo(songArtistName,songName)})}const allInOne=()=>{""===$("#search-term").val()?(M.toast({html:"You must enter a search term!",classes:"toast-warning"}),$("#search-btn").addClass("disabled")):hasSearched?hasSearched&&(animateOut(),setTimeout(function(){updateSearchStats(),getArtistAMGID(),mediaWikiSummaryAJAX(),$("#search-btn").addClass("disabled"),$(".collapsible").empty(),animateIn()},1e3)):(updateSearchStats(),getArtistAMGID(),mediaWikiSummaryAJAX(),$("#search-btn").addClass("disabled"),$(".collapsible").empty(),animateIn(),hasSearched=!0)};function youtubeVideo(songArtistName,songName){let APIKey="AIzaSyCi8-fme3jt8JWOwsFM6LVR2EnO6R7m2fY",QueryURL="https://www.googleapis.com/youtube/v3/search";var songVideo="";$.ajax({cache:!1,data:$.extend({key:APIKey,q:`${songName} ${songArtistName}`},{maxResults:1,type:"video",category:"music",videoEmbeddable:"true",part:"snippet"}),dataType:"json",type:"GET",timeout:3500,url:QueryURL}).then(function(videoData){console.log("ITSS PEWWWDIEEPIE"),console.log(videoData);let videoObj=videoData.items[0].id.videoId;songVideo=`<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoObj}" class="youtube-iframe">`,console.log("MADE IT"),console.log(songVideo);const $iFrame=$(songVideo);$(".youtube-content").append($iFrame),$(".youtube-iframe").attr("height",`${$(".youtube-iframe").width()/1.777778}px`)})}$("#search-btn").on("click",function(){allInOne()}),$("#search-term").each(function(){const elem=$(this);elem.bind("changes input paste",function(event){""!=elem.val()?$("#search-btn").removeClass("disabled").addClass("hvr-icon-grow"):$("#search-btn").addClass("disabled").removeClass("hvr-icon-grow")})}),$(".album-list").on("click",".song",lyricsAJAX),$(".read-more").on("click",function(){let totalHeight=0,$button=$(this),$up=$button.parent(),$ps=$up.find("p:not('.read-more')");return"open"===$(this).attr("data-state")?($ps.each(function(){totalHeight+=$(this).outerHeight(),totalHeight+=25}),$up.css({height:$up.height(),"max-height":9999}).animate({height:totalHeight+=48}),$(".read-more a").text("Close"),$button.attr("data-state","close"),!1):"close"===$(this).attr("data-state")?($up.animate({height:240}),$(".read-more a").text("Read More"),$button.attr("data-state","open"),!1):void 0}),$(document.body).on("mouseenter",".album-list",function(){$(this).css("z-index",500)}),$(document.body).on("mouseleave",".album-list",function(){$(this).css("z-index",0)}),$(function(){$(".input-field").each(function(){$(this).find("input").keypress(function(e){10!=e.which&&13!=e.which||allInOne()})})}),$(window).resize(function(){$(".youtube-iframe").attr("height",`${$(".youtube-iframe").width()/1.777778}px`)})});